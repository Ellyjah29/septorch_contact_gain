<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div class="login-container" id="loginPage">
        <h2>Admin Login</h2>
        <input type="password" id="adminPassword" placeholder="Enter Password">
        <button onclick="adminLogin()">Login</button>
        <p id="loginMessage"></p>
    </div>

    <div class="admin-container" id="adminPage" style="display: none;">
        <header>
            <img src="logo.png" alt="Logo" class="logo">
            <h1>Admin Panel</h1>
            <button onclick="logout()">Logout</button>
        </header>
        <section>
            <h2>WhatsApp Bot Status: <span id="waStatus">Checking...</span></h2>
        </section>
        <section>
            <h2>Users</h2>
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Phone</th>
                        <th>Email</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="userTable"></tbody>
            </table>
        </section>
    </div>

    <script>
        function adminLogin() {
            const password = document.getElementById("adminPassword").value;
            $.post("/api/adminLogin", { password }, function(response) {
                localStorage.setItem("adminToken", response.token);
                showAdminPanel();
            }).fail(function() {
                document.getElementById("loginMessage").innerText = "Invalid Password";
            });
        }

        function showAdminPanel() {
            document.getElementById("loginPage").style.display = "none";
            document.getElementById("adminPage").style.display = "block";
            fetchUsers();
        }

        function fetchUsers() {
            $.ajax({
                url: "/api/getUsers",
                headers: { "x-admin-token": localStorage.getItem("adminToken") },
                success: function(users) {
                    let rows = "";
                    users.forEach(user => {
                        rows += `<tr>
                                    <td>${user.name}</td>
                                    <td>${user.phone}</td>
                                    <td>${user.email}</td>
                                    <td>
                                        <button onclick="removeUser('${user.phone}')">Remove</button>
                                    </td>
                                 </tr>`;
                    });
                    document.getElementById("userTable").innerHTML = rows;
                }
            });
        }

        function removeUser(phone) {
            $.ajax({
                url: "/api/removeUser",
                type: "POST",
                headers: { "x-admin-token": localStorage.getItem("adminToken") },
                data: { phone },
                success: fetchUsers
            });
        }

        function logout() {
            localStorage.removeItem("adminToken");
            location.reload();
        }
    </script>
</body>
</html>
