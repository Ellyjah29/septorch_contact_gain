<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: url('https://files.catbox.moe/s7xpty.jpg') no-repeat center center fixed;
      background-size: cover;
      color: #333;
    }
    header {
      background: rgba(0, 0, 0, 0.7);
      color: white;
      text-align: center;
      padding: 20px 0;
    }
    header img {
      width: 100px;
      margin-bottom: 10px;
    }
    main {
      padding: 20px;
    }
    section {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
      padding: 20px;
    }
    h2, h3 {
      margin-top: 0;
      color: #4CAF50;
    }
    label {
      display: block;
      margin: 10px 0 5px;
      font-weight: bold;
    }
    input[type="password"], input[type="file"], input[type="text"], textarea, input[type="datetime-local"] {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 1rem;
    }
    button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1rem;
    }
    button:hover {
      background: #45a049;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    th {
      background: #f2f2f2;
    }
    tr:hover {
      background-color: #f1f1f1;
    }
    .hidden {
      display: none;
    }
    footer {
      text-align: center;
      padding: 10px 0;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      position: fixed;
      bottom: 0;
      width: 100%;
    }
    footer a {
      color: #fff;
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <header>
    <img src="https://files.catbox.moe/mdeuf8.jpeg" alt="Logo">
    <h1>Admin Panel</h1>
    <p>Manage Users and WhatsApp Bot</p>
  </header>
  <main>
    <!-- Admin Authentication -->
    <section id="authSection">
      <h2>Admin Login</h2>
      <label for="adminPassword">Enter Admin Password:</label>
      <input type="password" id="adminPassword" placeholder="Admin Password">
      <button id="loginBtn">Login</button>
      <p id="loginError" class="hidden" style="color: red;">Invalid password, please try again.</p>
    </section>

    <!-- Admin Dashboard -->
    <section id="adminDashboard" class="hidden">
      <h2>Dashboard</h2>

      <!-- WhatsApp Status -->
      <div id="whatsappStatus">WhatsApp Bot is disconnected</div>
      <hr>

      <!-- QR Code Section -->
      <h3>WhatsApp Login QR Code</h3>
      <div id="qrCodeContainer">
        <img id="qrCode" class="hidden" alt="QR Code">
        <p id="qrStatus">Waiting for QR Code...</p>
      </div>
      <hr>

      <!-- Pairing Code Section -->
      <h3>Login via Pairing Code</h3>
      <input type="text" id="pairingPhone" placeholder="Enter phone number e.g. +1234567890">
      <button onclick="startPairing()">Generate Pairing Code</button>
      <p id="pairingCodeStatus">Waiting for pairing code...</p>
      <hr>

      <!-- User Management -->
      <h3>User Management</h3>
      <button id="loadUsersBtn">Load All Users</button>
      <table id="userTable">
        <thead>
          <tr>
            <th>#</th><th>Name</th><th>Phone</th><th>Email</th><th>Joined</th><th>Actions</th>
          </tr>
        </thead>
        <tbody id="userTableBody"></tbody>
      </table>
      <button id="exportCSVBtn">Export User Data as CSV</button>
      <hr>

      <!-- VCF Upload -->
      <h3>Upload Custom VCF</h3>
      <form id="vcfForm" enctype="multipart/form-data">
        <input type="file" id="vcfFile" name="vcfFile" accept=".vcf" required>
        <button type="submit">Upload VCF</button>
        <button type="reset">Reset</button>
      </form>
      <hr>

      <!-- Announcements -->
      <h3>Schedule WhatsApp Announcement</h3>
      <form id="announcementForm">
        <label for="announcementMessage">Message:</label>
        <textarea id="announcementMessage" required></textarea>
        <label for="announcementDate">Schedule Date/Time:</label>
        <input type="datetime-local" id="announcementDate" required>
        <button type="submit">Schedule Announcement</button>
        <button type="reset">Reset</button>
      </form>
    </section>
  </main>

  <footer>
    <p>&copy; 2025 SEPTORCH. Powered by <a href="https://www.tiktok.com/@septorch">Septorch</a></p>
  </footer>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const loginBtn = document.getElementById('loginBtn');
    const adminPassword = document.getElementById('adminPassword');
    const loginError = document.getElementById('loginError');
    const authSection = document.getElementById('authSection');
    const adminDashboard = document.getElementById('adminDashboard');

    socket.on('whatsappStatus', (status) => {
      const statusEl = document.getElementById('whatsappStatus');
      statusEl.textContent = status === 'connected' ? 'WhatsApp Bot is connected' : 'WhatsApp Bot is disconnected';
      statusEl.style.color = status === 'connected' ? 'green' : 'red';
    });

    socket.on('whatsappQR', (data) => {
      const qr = document.getElementById('qrCode');
      const status = document.getElementById('qrStatus');
      if (data) {
        qr.src = data;
        qr.classList.remove('hidden');
        status.textContent = 'Scan with WhatsApp';
      } else {
        qr.classList.add('hidden');
        status.textContent = 'QR Code not available.';
      }
    });

    socket.on('pairingCode', (code) => {
      const pStatus = document.getElementById('pairingCodeStatus');
      pStatus.textContent = `Pairing Code: ${code}`;
      pStatus.style.color = 'blue';
    });

    loginBtn.onclick = () => {
      const pass = adminPassword.value;
      fetch('/api/adminLogin', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ password: pass })
      }).then(res => res.json()).then(data => {
        if (data.message === 'Login successful') {
          authSection.classList.add('hidden');
          adminDashboard.classList.remove('hidden');
        } else {
          loginError.classList.remove('hidden');
        }
      }).catch(() => loginError.classList.remove('hidden'));
    };

    function startPairing() {
      const phone = document.getElementById('pairingPhone').value;
      const token = adminPassword.value;
      if (!phone) return alert('Enter a valid phone number');
      fetch('/api/startPairing', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'x-admin-token': token
        },
        body: JSON.stringify({ phone })
      }).then(res => res.json())
      .then(data => alert(data.message || 'Pairing started.'))
      .catch(() => alert('Error starting pairing.'));
    }

    // Other user-related JS already included...
  </script>
</body>
</html>
